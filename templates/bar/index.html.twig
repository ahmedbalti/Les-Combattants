{% extends 'base.html.twig' %}

{% block title %}Bar{% endblock %}

{% block content %}
    <section id="container">
        <section id="main-content">
            <section class="wrapper">
                <h3><i class="fa fa-angle-right"></i> GÃ©rer les Club</h3>



                <div class="row mt">
                    <div class="col-md-12">
                        <div class="content-panel">
                            <table class="table table-striped table-advance table-hover">

                                <div class="top-menu">
                                    <ul class="nav pull-right top-menu">
                                        <li>
                                            <a style="color: #f2f2f2;" class="btn btn-theme" href="{{ path('bar_new') }}">Ajouter</a>

                                        </li>
                                        <li>
                                            <form class="pull-right hidden" role="search" id="nav-search-form" method="post">
                                                <div class="input-append">
                                                    <input name ="search" id="search" type="text" class="form-control " placeholder="Search">
                                                </div>
                                            </form>
                                        </li>
                                    </ul>
                                </div>
                                <br>
                                <br>
                                <br>
                                <hr>
                                <thead>
                                <tr>
                                    <th style="width: 10%" class="hidden-phone"><i class="fa fa-pencil "></i> Nom</th>
                                    <th style="width: 10%"><i class="fa fa-location-arrow"></i> Lieu</th>
                                    <th style="width: 35%"><i class=" fa fa-edit"></i> Description</th>
                                    <th style="width: 10%"><i class=" fa fa-star"></i> Rating</th>
                                    <th style="width: 10%"><i class=" fa fa-file-image-o"></i> Image</th>
                                    <th style="width: 10%"></th>
                                </tr>
                                </thead>
                                <tbody id="barsHtml">
                                <!--affichage des retaurents-->
                                {%for bar in bars %}
                                    <tr>
                                        <td class="hidden-phone">{{ bar.nom }}</td>
                                        <td>{{ bar.lieu }} </td>
                                        <td>{{ bar.description }} </td>
                                        <td>
                                            {% if ratings[loop.index - 1] == 0 %}
                                                <span class="fa fa-star-o"></span>
                                                <span class="fa fa-star-o"></span>
                                                <span class="fa fa-star-o"></span>
                                                <span class="fa fa-star-o"></span>
                                                <span class="fa fa-star-o"></span>

                                            {% elseif ratings[loop.index - 1] == 1 %}

                                                <span class="fa fa-star"></span>
                                                <span class="fa fa-star-o"></span>
                                                <span class="fa fa-star-o"></span>
                                                <span class="fa fa-star-o"></span>
                                                <span class="fa fa-star-o"></span>

                                            {% elseif ratings[loop.index - 1] == 2 %}

                                                <span class="fa fa-star"></span>
                                                <span class="fa fa-star"></span>
                                                <span class="fa fa-star-o"></span>
                                                <span class="fa fa-star-o"></span>
                                                <span class="fa fa-star-o"></span>

                                            {% elseif ratings[loop.index - 1] == 3 %}

                                                <span class="fa fa-star"></span>
                                                <span class="fa fa-star"></span>
                                                <span class="fa fa-star"></span>
                                                <span class="fa fa-star-o"></span>
                                                <span class="fa fa-star-o"></span>

                                            {% elseif ratings[loop.index - 1] == 4 %}

                                                <span class="fa fa-star"></span>
                                                <span class="fa fa-star"></span>
                                                <span class="fa fa-star"></span>
                                                <span class="fa fa-star"></span>
                                                <span class="fa fa-star-o"></span>

                                            {% elseif ratings[loop.index - 1] == 5 %}

                                                <span class="fa fa-star"></span>
                                                <span class="fa fa-star"></span>
                                                <span class="fa fa-star"></span>
                                                <span class="fa fa-star"></span>
                                                <span class="fa fa-star"></span>

                                            {% else %}

                                                <span class="fa fa-star-0"></span>
                                                <span class="fa fa-star-o"></span>
                                                <span class="fa fa-star-o"></span>
                                                <span class="fa fa-star-o"></span>
                                                <span class="fa fa-star-o"></span>

                                            {% endif %}
                                            ({{ rating_count[loop.index - 1] }})
                                        </td>

                                        <td>
                                            <div class="fileupload-new thumbnail" >
                                                <img src="/img/{{ bar.file }}" alt="" style="width: 200px; height: 100px;" />
                                            </div>
                                        </td>
                                        <td>
                                            <a href="{{ path('table_r',{'id':bar.id}) }}"><button class="btn btn-success btn-xs"><i class="fa fa-check"></i></button></a>
                                            <a href="{{ path('bar_edit',{'id':bar.id}) }}"><button class="btn btn-primary btn-xs"><i class="fa fa-pencil"></i></button></a>
                                            <a href="{{ path('bar_delete',{'id':bar.id}) }}"><button class="btn btn-danger btn-xs"><i class="fa fa-trash-o "></i></button></a>
                                            <a href="{{ path('qrcode_bar',{'id':bar.id}) }}"><button class="btn btn-default btn-xs"><i class="fa fa-qrcode "></i></button></a>
                                        </td>
                                    </tr>

                                {% endfor %}

                                </tbody>
                            </table>

                            <div class="centered mt">
                                {{ knp_pagination_render(bars) }}
                            </div>

                        </div>
                        <!-- /content-panel -->
                    </div>
                    <!-- /col-md-12 -->
                </div>
                <!-- /row -->
            </section>
        </section>
        <!-- /MAIN CONTENT -->
        <!--main content end-->
        <!--footer start-->
        <footer class="site-footer">
            <div class="text-center">
                <p>
                    <strong></strong>
                </p>
                <div class="credits">
                    <!--
                      You are NOT allowed to delete the credit link to TemplateMag with free version.
                      You can delete the credit link only if you bought the pro version.
                      Buy the pro version with working PHP/AJAX contact form: https://templatemag.com/dashio-bootstrap-admin-template/
                      Licensing information: https://templatemag.com/license/
                    -->
                    <a href="https://templatemag.com/"> </a>
                </div>
                <a href="basic_table.html#" class="go-top">
                    <i class="fa fa-angle-up"></i>
                </a>
            </div>
        </footer>
        <!--footer end-->
    </section>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

    <script type="text/javascript">
        jQuery(document).ready(function() {
            var searchRequest = null;
            //keyup bouton tla3
            $("#search").keyup(function() {
                var minlength = 0;
                var that = this;
                var value = $(this).val();
                //restaurenthtml win bch na3mlo affichage lel retaurents
                var barSelector = $("#barsHtml").html('');
                if (value.length >= minlength ) {
                    if (searchRequest != null)
                        searchRequest.abort();
                    searchRequest = $.ajax({
                        type: "GET",
                        url: "{{ path('resto_ajax_search') }}",
                        data: {
                            'q' : value
                        },
                        dataType: "text",
                        success: function(msg){

                            var result = JSON.parse(msg);
                            $.each(result, function(key, arr) {

                                var link_edit = "{{ path("bar_edit",{'id': "ID"}) }}"
                                link_edit = link_edit.replace("ID", arr['id']);

                                var link_delete = "{{ path("bar_delete",{'id': "ID"}) }}"
                                link_delete = link_delete.replace("ID", arr['id']);
                                //append ma3neha 7ot fl blasa athika el html
                                restaurentSelector.append('<tr>'+
                                    '<td class="hidden-phone">'+arr['nom']+'</td>'+
                                    '<td>'+arr['lieu']+'</td>'+
                                    '<td>'+arr['description']+'</td>'+
                                    '<td><div class="fileupload-new thumbnail"><img src="/img/'+arr['file']+'" alt="" style="width: 200px; height: 100px;" /></div></td>'+
                                    '<td><button class="btn btn-success btn-xs"><i class="fa fa-check"></i></button>'+
                                    '<a href='+link_edit+'> <button class="btn btn-primary btn-xs"><i class="fa fa-pencil"></i></button> </a>'+
                                    '<a href='+link_delete+'> <button class="btn btn-danger btn-xs"><i class="fa fa-trash-o "></i></button> </a></td></tr>');
                            });
                        },
                        error: function (request, status, error) {
                            console.log("error");
                        }
                    });
                }
            });
        });
    </script>

{% endblock %}
