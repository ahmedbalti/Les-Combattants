{% extends 'base.html.twig' %}

{% block title %}Homes{% endblock %}

{% block content %}
    <section id="container">
        <section id="main-content">
            <section class="wrapper">
                <h3><i class="fa fa-angle-right"></i> GÃ©rer les Homes Guest</h3>



                <div class="row mt">
                    <div class="col-md-12">
                        <div class="content-panel">
                            <table class="table table-striped table-advance table-hover">

                                <div class="top-menu">
                                    <ul class="nav pull-right top-menu">
                                        <li>
                                            <a style="color: #f2f2f2;" class="btn btn-primary" href="{{ path('home_new') }}">Add Home Guest</a>

                                        </li>
                                        <li>
                                            <form class="pull-right hidden" role="search" id="nav-search-form" method="post">
                                                <div class="input-append">
                                                    <input name ="search" id="search" type="text" class="form-control " placeholder="Search">
                                                </div>
                                            </form>
                                        </li>
                                    </ul>
                                </div>
                                <br>
                                <br>
                                <br>
                                <hr>
                                <thead>
                                <tr>
                                    <th><i class="fa fa-bullhorn"></i> Name</th>
                                    <th class="hidden-phone"><i class="fa fa-question-circle"></i> Stars Number</th>
                                    <th><i class="fa fa-bookmark"></i> Rooms Number</th>
                                    <th><i class=" fa fa-edit"></i> Address</th>
                                    <th><i class=" fa fa-edit"></i> Description</th>
                                    <th><i class="fa fa-bullhorn"></i> Image</th>
                                    <th><i class=" fa fa-edit"></i> Actions</th>
                                    <th style="width: 10%"></th>
                                </tr>
                                </thead>
                                <tbody id="homesHtml">
                                <!--affichage des hotelss-->
                                {%for home in homes %}
                                    <tr>
                                        <td class="hidden-phone">{{ home.Name }}</td>
                                        <td>{{ home.NbStars }}</td>
                                        <td>{{ home.NbRooms }}</td>
                                        <td>{{ home.Address }}</td>
                                        <td>{{ home.Description }}</td>


                                        <td>
                                            <div class="fileupload-new thumbnail" >
                                                <img src="/img/{{ home.file }}" alt="" style="width: 200px; height: 100px;" />
                                            </div>
                                        </td>
                                        <td>
                                            <a href="{{ path('room_r',{'id':home.id}) }}"><button class="btn btn-success btn-xs"><i class="fa fa-check"></i></button></a>
                                            <a href="{{ path('home_edit',{'id':home.id}) }}"><button class="btn btn-primary btn-xs"><i class="fa fa-pencil"></i></button></a>
                                            <a href="{{ path('home_delete',{'id':home.id}) }}"><button class="btn btn-danger btn-xs"><i class="fa fa-trash-o "></i></button></a>
                                        </td>
                                    </tr>

                                {% endfor %}

                                </tbody>
                            </table>

                            <div class="centered mt">
                                {{ knp_pagination_render(homes) }}
                            </div>

                        </div>
                        <!-- /content-panel -->
                    </div>
                    <!-- /col-md-12 -->
                </div>
                <!-- /row -->
            </section>
        </section>
        <!-- /MAIN CONTENT -->
        <!--main content end-->
        <!--footer start-->
        <footer class="site-footer">
            <div class="text-center">
                <p>
                    <strong></strong>
                </p>
                <div class="credits">
                    <!--
                      You are NOT allowed to delete the credit link to TemplateMag with free version.
                      You can delete the credit link only if you bought the pro version.
                      Buy the pro version with working PHP/AJAX contact form: https://templatemag.com/dashio-bootstrap-admin-template/
                      Licensing information: https://templatemag.com/license/
                    -->
                    <a href="https://templatemag.com/"> </a>
                </div>
                <a href="basic_table.html#" class="go-top">
                    <i class="fa fa-angle-up"></i>
                </a>
            </div>
        </footer>
        <!--footer end-->
    </section>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

    <script type="text/javascript">
        jQuery(document).ready(function() {
            var searchRequest = null;
            //keyup bouton tla3
            $("#search").keyup(function() {
                var minlength = 0;
                var that = this;
                var value = $(this).val();
                //homehtml win bch na3mlo affichage lel hotels
                var homeSelector = $("#homesHtml").html('');
                if (value.length >= minlength ) {
                    if (searchRequest != null)
                        searchRequest.abort();
                    searchRequest = $.ajax({
                        type: "GET",
                        url: "{{ path('home_ajax_search') }}",
                        data: {
                            'q' : value
                        },
                        dataType: "text",
                        success: function(msg){

                            var result = JSON.parse(msg);
                            $.each(result, function(key, arr) {

                                var link_edit = "{{ path("home_edit",{'id': "ID"}) }}"
                                link_edit = link_edit.replace("ID", arr['id']);

                                var link_delete = "{{ path("hotel_delete",{'id': "ID"}) }}"
                                link_delete = link_delete.replace("ID", arr['id']);
                                //append ma3neha 7ot fl blasa athika el html
                                hotelSelector.append('<tr>'+
                                    '<td class="hidden-phone">'+arr['Name']+'</td>'+
                                    '<td>'+arr['NbStars']+'</td>'+
                                    '<td>'+arr['NbRooms']+'</td>'+
                                    '<td>'+arr['Address']+'</td>'+
                                    '<td>'+arr['Description']+'</td>'+
                                    '<td><div class="fileupload-new thumbnail"><img src="/img/'+arr['file']+'" alt="" style="width: 200px; height: 100px;" /></div></td>'+
                                    '<td><button class="btn btn-success btn-xs"><i class="fa fa-check"></i></button>'+
                                    '<a href='+link_edit+'> <button class="btn btn-primary btn-xs"><i class="fa fa-pencil"></i></button> </a>'+
                                    '<a href='+link_delete+'> <button class="btn btn-danger btn-xs"><i class="fa fa-trash-o "></i></button> </a></td></tr>');
                            });
                        },
                        error: function (request, status, error) {
                            console.log("error");
                        }
                    });
                }
            });
        });
    </script>

{% endblock %}
